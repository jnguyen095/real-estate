function hiddenMapHandler(){$("#chMapHidden").on("ifChecked",function(){$("#map").show()}),$("#chMapHidden").on("ifUnchecked",function(){$("#map").hide()})}function calculatePrice(){var t=$("#sl_package").val(),e=$("#txt_fromdate").val(),a=$("#txt_todate").val();$(".overlay").show(),jQuery.ajax({type:"POST",url:urls.loadPrice4Package,dataType:"json",data:{"package":t,from_date:e,to_date:a},success:function(t){var e=t.status,a=t.val;"no_authenticated"==e?($("#sl_package").val("standard"),bootbox.alert("Phải đăng nhập để sử dụng các gói tin VIP của Tin Đất Đai.",function(){})):"free_cost"==e?$("#packagePrice").html(a):"not_enough_quota"==e?($("#sl_package").val("standard"),$("#packagePrice").html(a),bootbox.alert("Tài khoản không đủ để thanh toán, vui lòng nạp thêm tiền vào tài khoản.<br/><a href='"+urls.base_url+"bao-gia-dich-vu.html'>Hướng dẫn nạp tiền</a>",function(){})):"valid_payment"==e?$("#packagePrice").html(a):"not_qualify_input"==e&&$("#packagePrice").html(a),$(".overlay").hide()}})}function inactivePostHandler(){$(".inactive-post").click(function(){var t=$(this).data("post");bootbox.confirm("Bạn đã chắc chắn không hiễn thị tin rao này?",function(e){e&&($("#productId").val(t),$("#crudaction").val("inactive"),$("#frmPost").submit())})})}function activePostHandler(){$(".active-post").click(function(){var t=$(this).data("post");$("#productId").val(t),$("#crudaction").val("active"),$("#frmPost").submit()})}function deletePostHandler(){$(".remove-post").click(function(){var t=$(this).data("post");bootbox.confirm("Bạn đã chắc chắn xóa tin rao này chưa?",function(e){e&&($("#productId").val(t),$("#crudaction").val("delete"),$("#frmPost").submit())})})}function refreshPostHandler(){$(".refresh-post").click(function(){var t=$(this).data("post");$("#productId").val(t),$("#crudaction").val("refresh"),$("#frmPost").submit()})}function autoComplete(){$(".typeahead").length>0&&$(".typeahead").typeahead({hint:!0,highlight:!0,minLength:2},{name:"states",async:!0,displayKey:"Street",source:function(t,e){return $.get(urls.findStreetByNameUrl,{query:t},function(t){if(getGeoFromAddress(),null!=t&&t.length>0){var a=$.parseJSON(t);return getGeoFromAddress(),e(a)}})}})}function loadWardByDistrictId(){$("#txtDistrict").change(function(){var t=$(this).val();$(".overlay").show(),jQuery.ajax({type:"POST",url:urls.loadWardByDistrictId,dataType:"json",data:{districtId:t},success:function(t){document.getElementById("txtWard").options.length=1;for(key in t)$("#txtWard").append("<option value='"+t[key].WardID+"'>"+t[key].WardName+"</option>");getGeoFromAddress(),$(".overlay").hide()}})})}function loadDistrictByCityId(){$("#txtCity").change(function(){$(".overlay").show();var t=$(this).val();document.getElementById("txtWard").options.length=1,jQuery.ajax({type:"POST",url:urls.loadDistrictByCityId,dataType:"json",data:{cityId:t},success:function(t){document.getElementById("txtDistrict").options.length=1;for(key in t)$("#txtDistrict").append("<option value='"+t[key].DistrictID+"'>"+t[key].DistrictName+"</option>");getGeoFromAddress(),$(".overlay").hide()}})})}function uploadMultipleImages(){$(".finish-upload").click(function(){$(".finish-upload .finish-text").hide(),$(".finish-upload .loadUploadOthers").show();var t=document.getElementById("uploadImagesForm"),e=new FormData(t);$.ajax({url:urls.uploadOthersImages,type:"POST",data:e,contentType:!1,cache:!1,processData:!1,success:function(t){var e=!0;if(null!=t&&t.length>0){var a=$.parseJSON(t);null!=a.error&&a.error.length>0&&(e=!1)}e&&reloadOthersImagesContainer(),$(".finish-upload .finish-text").show(),$(".finish-upload .loadUploadOthers").hide(),$("#modalMoreImages").modal("hide"),document.getElementById("uploadImagesForm").reset()}})})}function reloadOthersImagesContainer(){$(".others-images-container").empty(),$(".others-images-container").load(urls.loadOthersImages,{txt_folder:$('[name="txt_folder"]').val()})}function removeSecondaryProductImage(t,e,a){$.ajax({type:"POST",url:urls.removeSecondaryImage,data:{image:t,txt_folder:e}}).done(function(t){$("#image-container-"+a).remove()})}function updateCoordinators(t,e,a){$.ajax({type:"POST",url:urls.updateCoordinatorMapUrl,data:{productId:t,lng:e,lat:a}}).done(function(t){})}function defaultMap(){infoWindow=new google.maps.InfoWindow;var t={lat:14.0583,lng:108.2772};_map=new google.maps.Map(document.getElementById("map"),{zoom:5,center:t}),_marker=new google.maps.Marker({position:t,map:_map,label:"K"});var e=document.createElement("div"),a=document.createElement("strong");a.textContent="Việt Nam",e.appendChild(a),google.maps.event.addListener(_map,"click",function(t){_marker.setPosition(t.latLng),$("input[name=txt_lng]").val(t.latLng.lng()),$("input[name=txt_lat]").val(t.latLng.lat())}),infoWindow.setContent(e),infoWindow.open(_map,_marker)}function initMap(t,e,a){var n={lat:t,lng:e};_map.setZoom(17),_map.setCenter(n),_marker.setPosition(n);var o=document.createElement("strong");o.textContent=a;var i=document.createElement("div");i.appendChild(o),infoWindow.setContent(i),infoWindow.open(_map,_marker),_marker.addListener("click",function(){infoWindow.setContent(i),infoWindow.open(_map,_marker)})}function getGeoFromAddress(){var t=$("#txtCity").val(),e=$("#txtDistrict").val(),a=$("#txtWard").val(),n=$("#txt_street").val(),o="";n.length>1&&(o=n+", "),!isNaN(a)&&a>0&&(o+=$("#txtWard option:selected").text()+", "),!isNaN(e)&&e>0&&(o+=$("#txtDistrict option:selected").text()+", "),!isNaN(t)&&t>0&&(o+=$("#txtCity option:selected").text()+", "),o.length>2&&(o=o.substr(0,o.length-2)),_oldAddr!=o&&(_oldAddr=o,jQuery.ajax({type:"POST",url:urls.loadGeoFromAddrUrl,dataType:"json",data:{address:o},success:function(t){initMap(t[1],t[0],o),$("input[name=txt_lng]").val(t[0]),$("input[name=txt_lat]").val(t[1])}}))}function loadMap(t,e,a){initMap(t,e,a),$("input[name=txt_lng]").val(e),$("input[name=txt_lat]").val(t)}$(document).ready(function(){uploadMultipleImages(),loadDistrictByCityId(),loadWardByDistrictId(),autoComplete(),deletePostHandler(),refreshPostHandler(),activePostHandler(),inactivePostHandler(),$("#txtWard").change(function(){getGeoFromAddress()}),$("#sl_package").change(function(){calculatePrice()}),$("#txt_fromdate").change(function(){calculatePrice()}),$("#txt_todate").change(function(){calculatePrice()}),hiddenMapHandler()});var _map,_marker,infoWindow,_oldAddr=null;
